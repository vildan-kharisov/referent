# План реализации функций AI-обработки статей

## Цель проекта
Приложение получает на входе адрес англоязычной статьи, выполняет парсинг и, по соответствующей кнопке, подключает AI и выполняет нужное действие.

## Текущее состояние
- ✅ Реализован парсинг статей (извлечение даты, заголовка, контента)
- ✅ Реализован перевод статей через AI
- ✅ Интерфейс с кнопками готов
- ✅ **Этап 1 завершен:** Подготовка инфраструктуры AI (утилита `app/lib/ai.ts` создана)
- ✅ **Этап 2 завершен:** Реализована функция "О чем статья?" с AI-анализом
- ✅ **Этап 3 завершен:** Реализована функция "Тезисы" с извлечением ключевых тезисов
- ⏳ Функция кнопки "Пост для Telegram" требует реализации

## План действий

### Этап 1: Подготовка инфраструктуры AI

1. **Выбор AI-провайдера**
   - Определить доступный AI-сервис (OpenRouter, YandexGPT, или другой)
   - Учесть региональные ограничения
   - Настроить API ключи в `.env.local`

2. **Создание утилиты для работы с AI**
   - Создать файл `app/lib/ai.ts` или `app/utils/ai.ts`
   - Реализовать функцию `callAI(prompt: string, model: string)` для универсальных запросов
   - Добавить обработку ошибок и retry-логику
   - Реализовать разбиение длинных текстов на части (chunking) для больших статей

### Этап 2: Реализация функции "О чем статья?"

1. **Разработка промпта**
   - Создать системный промпт для краткого описания статьи
   - Требования: 2-3 предложения, основные темы, ключевые идеи
   - Язык ответа: русский

2. **Интеграция в API**
   - В `app/api/analyze/route.ts` добавить обработку режима `mode === "about"`
   - После парсинга статьи вызвать AI с промптом для описания
   - Вернуть результат в формате: `{ summary: "..." }`

3. **Тестирование**
   - Проверить на разных типах статей
   - Убедиться, что ответы информативны и краткие

### Этап 3: Реализация функции "Тезисы"

1. **Разработка промпта**
   - Создать системный промпт для извлечения тезисов
   - Требования: 5-7 ключевых тезисов, каждый в отдельной строке
   - Формат: маркированный список или нумерованный список
   - Язык ответа: русский

2. **Интеграция в API**
   - В `app/api/analyze/route.ts` добавить обработку режима `mode === "thesis"`
   - После парсинга статьи вызвать AI с промптом для тезисов
   - Вернуть результат в формате: `{ thesis: "..." }` или `{ thesis: ["...", "..."] }`

3. **Обработка результата**
   - Парсинг ответа AI (разделение на отдельные тезисы)
   - Форматирование для отображения в интерфейсе

4. **Тестирование**
   - Проверить качество извлечения тезисов
   - Убедиться, что тезисы отражают основные идеи статьи

### Этап 4: Реализация функции "Пост для Telegram"

1. **Разработка промпта**
   - Создать системный промпт для генерации Telegram-поста
   - Требования:
     - Захватывающий заголовок/заход
     - 2-3 ключевых мысли из статьи
     - Призыв к действию (перейти по ссылке)
     - Эмодзи для привлекательности
     - Длина: ~500-800 символов
   - Язык ответа: русский

2. **Интеграция в API**
   - В `app/api/analyze/route.ts` добавить обработку режима `mode === "telegram"`
   - После парсинга статьи вызвать AI с промптом для Telegram-поста
   - Передать в промпт оригинальный URL статьи для ссылки
   - Вернуть результат в формате: `{ telegramPost: "..." }`

3. **Форматирование результата**
   - Сохранение структуры поста (заголовок, абзацы, ссылка)
   - Возможность копирования в один клик

4. **Тестирование**
   - Проверить читаемость и привлекательность постов
   - Убедиться, что посты соответствуют стилю Telegram

### Этап 5: Оптимизация и улучшения

1. **Кэширование результатов**
   - Реализовать кэширование ответов AI по URL статьи
   - Использовать Next.js cache или внешний кэш (Redis)
   - Сократить количество запросов к AI и снизить затраты

2. **Обработка длинных статей**
   - Реализовать разбиение контента на части
   - Обработка каждой части отдельно
   - Агрегация результатов

3. **Улучшение UX**
   - Добавить индикаторы прогресса для длинных операций
   - Показывать примеры/превью перед генерацией
   - Добавить возможность редактирования результата

4. **Обработка ошибок**
   - Улучшить сообщения об ошибках
   - Добавить fallback-варианты при недоступности AI
   - Логирование ошибок для отладки

### Этап 6: Документация и финализация

1. **Обновление документации**
   - Обновить README.md с инструкциями по настройке AI
   - Добавить примеры использования каждой функции
   - Описать формат ответов API

2. **Тестирование всех функций**
   - Интеграционное тестирование всех режимов
   - Проверка на различных типах статей
   - Проверка производительности

3. **Оптимизация производительности**
   - Оптимизация промптов для уменьшения времени ответа
   - Параллельная обработка, где возможно
   - Мониторинг использования API и затрат

## Технические детали

### Структура API ответа

```typescript
// Режим "about"
{
  summary: string
}

// Режим "thesis"
{
  thesis: string[] // или string с разделителями
}

// Режим "telegram"
{
  telegramPost: string
}
```

### Примеры промптов

**"О чем статья?"**
```
Ты - эксперт по анализу текстов. Прочитай следующую статью и напиши краткое описание (2-3 предложения) на русском языке, объясняющее основную тему и ключевые идеи статьи.
```

**"Тезисы"**
```
Ты - эксперт по анализу текстов. Прочитай следующую статью и выдели 5-7 ключевых тезисов на русском языке. Каждый тезис должен быть в отдельной строке и начинаться с дефиса.
```

**"Пост для Telegram"**
```
Ты - копирайтер для социальных сетей. Напиши привлекательный пост для Telegram на основе следующей статьи. Пост должен включать:
1. Захватывающий заголовок/заход
2. 2-3 ключевых мысли из статьи простым языком
3. Призыв перейти по ссылке: [URL статьи]
Используй эмодзи для привлекательности. Длина поста: 500-800 символов.
```

## Порядок реализации (приоритет)

1. **Этап 1** - Подготовка инфраструктуры AI (базовая функция вызова AI)
2. **Этап 2** - Реализация "О чем статья?" (самая простая функция)
3. **Этап 3** - Реализация "Тезисы" (средняя сложность)
4. **Этап 4** - Реализация "Пост для Telegram" (требует больше настройки промпта)
5. **Этап 5** - Оптимизация и улучшения
6. **Этап 6** - Документация и финализация

## Зависимости

- AI-провайдер (OpenRouter/YandexGPT/другой)
- API ключи в `.env.local`
- Существующая инфраструктура парсинга статей

